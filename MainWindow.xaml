<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="SimpleMD.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SimpleMD"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="SimpleMD - Markdown Viewer">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="32"/>
        </Grid.RowDefinitions>

        <!-- Title Bar Area -->
        <Grid Grid.Row="0" x:Name="AppTitleBar">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- App Icon and Title -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" Margin="16,0">
                <Image Source="Assets/Square44x44Logo.targetsize-24_altform-unplated.png" 
                       Width="16" Height="16"
                       VerticalAlignment="Center"/>
                <TextBlock Text="SimpleMD" 
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Command Bar -->
            <CommandBar Grid.Column="2" DefaultLabelPosition="Right" Background="Transparent">
                <AppBarButton x:Name="OpenFileButton" Icon="OpenFile" Label="Open">
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="O"/>
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarSeparator/>
                <AppBarButton x:Name="RefreshButton" Icon="Refresh" Label="Refresh">
                    <AppBarButton.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F5"/>
                    </AppBarButton.KeyboardAccelerators>
                </AppBarButton>
                <AppBarButton x:Name="ZoomInButton" Icon="ZoomIn" Label="Zoom In"/>
                <AppBarButton x:Name="ZoomOutButton" Icon="ZoomOut" Label="Zoom Out"/>
                <CommandBar.SecondaryCommands>
                    <AppBarButton x:Name="PrintButton" Icon="Print" Label="Print"/>
                    <AppBarButton x:Name="SaveAsHtmlButton" Icon="Save" Label="Export as HTML"/>
                    <AppBarSeparator/>
                    <AppBarButton x:Name="SettingsButton" Icon="Setting" Label="Settings"/>
                    <AppBarButton x:Name="AboutButton" Icon="Help" Label="About"/>
                </CommandBar.SecondaryCommands>
            </CommandBar>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <!-- Loading Progress -->
            <ProgressRing x:Name="LoadingRing" 
                          IsActive="False"
                          Width="60"
                          Height="60"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"/>

            <!-- Welcome Screen -->
            <Grid x:Name="WelcomePanel" 
                  HorizontalAlignment="Center" 
                  VerticalAlignment="Center"
                  Visibility="Visible">
                <StackPanel Spacing="24" HorizontalAlignment="Center">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE943;" 
                              FontSize="72"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="Open a Markdown file to begin" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <Button x:Name="OpenFileButtonLarge" 
                            HorizontalAlignment="Center"
                            Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                      Glyph="&#xE838;" 
                                      FontSize="16"/>
                            <TextBlock Text="Open File"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="or drag and drop a .md file here" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                </StackPanel>
            </Grid>

            <!-- WebView2 for Markdown Display -->
            <Border x:Name="WebViewBorder" 
                    Visibility="Collapsed"
                    Margin="0"
                    CornerRadius="0">
                <WebView2 x:Name="MarkdownWebView"
                          NavigationStarting="MarkdownWebView_NavigationStarting"/>
            </Border>

            <!-- Drop Overlay -->
            <Border x:Name="DropOverlay"
                    Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                    Visibility="Collapsed"
                    AllowDrop="True">
                <Grid>
                    <Rectangle Stroke="{ThemeResource AccentFillColorDefaultBrush}"
                               StrokeThickness="2"
                               StrokeDashArray="4,4"
                               Margin="24"
                               RadiusX="8"
                               RadiusY="8"/>
                    <StackPanel HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                Spacing="16">
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                  Glyph="&#xE898;" 
                                  FontSize="48"
                                  Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                        <TextBlock Text="Drop Markdown file here" 
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <Grid Margin="16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- File Path -->
                <TextBlock Grid.Column="0"
                           x:Name="FilePathText"
                           Text="No file loaded"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           ToolTipService.ToolTip="{x:Bind FilePathText.Text, Mode=OneWay}"/>

                <!-- Separators and Info -->
                <TextBlock Grid.Column="1" 
                           Text="|" 
                           Margin="12,0"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>

                <!-- Word Count -->
                <TextBlock Grid.Column="2"
                           x:Name="WordCountText"
                           Text="0 words"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="3" 
                           Text="|" 
                           Margin="12,0"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>

                <!-- Zoom Level -->
                <StackPanel Grid.Column="3" 
                            Orientation="Horizontal" 
                            Spacing="4"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE71E;" 
                              FontSize="12"
                              VerticalAlignment="Center"/>
                    <TextBlock x:Name="ZoomLevelText"
                               Text="100%"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Content Dialog for Settings -->
        <ContentDialog x:Name="SettingsDialog"
                       Title="Settings"
                       PrimaryButtonText="Save"
                       CloseButtonText="Cancel"
                       DefaultButton="Primary">
            <StackPanel Spacing="16" Width="400">
                <TextBlock Text="Appearance" Style="{StaticResource BaseTextBlockStyle}"/>
                <ComboBox x:Name="ThemeComboBox" 
                          Header="Theme"
                          HorizontalAlignment="Stretch">
                    <ComboBoxItem Content="System default" Tag="Default"/>
                    <ComboBoxItem Content="Light" Tag="Light"/>
                    <ComboBoxItem Content="Dark" Tag="Dark"/>
                </ComboBox>
                
                <TextBlock Text="Editor" Style="{StaticResource BaseTextBlockStyle}" Margin="0,16,0,0"/>
                <CheckBox x:Name="WordWrapCheckBox" 
                          Content="Enable word wrap"
                          IsChecked="True"/>
                <CheckBox x:Name="ShowLineNumbersCheckBox" 
                          Content="Show line numbers in code blocks"
                          IsChecked="True"/>
                
                <TextBlock Text="Preview" Style="{StaticResource BaseTextBlockStyle}" Margin="0,16,0,0"/>
                <Slider x:Name="DefaultZoomSlider"
                        Header="Default zoom level"
                        Minimum="50"
                        Maximum="200"
                        Value="100"
                        StepFrequency="10"
                        HorizontalAlignment="Stretch"/>
                <TextBlock Style="{StaticResource CaptionTextBlockStyle}">
                    <Run Text="Current: "/>
                    <Run Text="{x:Bind DefaultZoomSlider.Value, Mode=OneWay}"/>
                    <Run Text="%"/>
                </TextBlock>
            </StackPanel>
        </ContentDialog>

        <!-- About Dialog -->
        <ContentDialog x:Name="AboutDialog"
                       Title="About SimpleMD"
                       CloseButtonText="Close"
                       DefaultButton="Close">
            <StackPanel Spacing="16" Width="400">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <Image Source="Assets/Square44x44Logo.targetsize-24_altform-unplated.png" 
                           Width="64" Height="64"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="SimpleMD" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <TextBlock Text="Version 1.0.0" Style="{StaticResource CaptionTextBlockStyle}"/>
                    </StackPanel>
                </StackPanel>
                <TextBlock TextWrapping="Wrap" Style="{StaticResource BodyTextBlockStyle}">
                    A clean and modern Markdown viewer built with WinUI 3 and .NET 9.
                </TextBlock>
                <HyperlinkButton Content="View on GitHub" NavigateUri="https://github.com/yourusername/SimpleMD"/>
            </StackPanel>
        </ContentDialog>
    </Grid>
</Window>
